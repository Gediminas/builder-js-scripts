#!/usr/bin/env bash

if [ -z "$1" ]; then
    echo "Usage: build some-product"
    exit 1
fi

product=$1
root=$(realpath --no-symlinks "${BASH_SOURCE[0]}")
root=$(dirname "$root")
exe=$(realpath --no-symlinks "$root/recipies/$product")
tmp="$root/_working/$product/$(date +%F_%H-%M-%S)"
mkdir -p "$tmp"
# tmp=$(realpath --no-symlinks "$tmp")
#log="$tmp/main.log"

echo "----------"
echo "PROD: $exe"
echo "TEMP: $tmp"
#echo "LOG:  $log"

mkdir -p "$root/recipies" && pushd "$_" 1>/dev/null || exit
echo "PWD:  $PWD"
"$exe" "$tmp" | tee "$tmp/main.log"
popd 1>/dev/null 2>&1

echo "----------"
echo "[DONE]"
echo "Press ENTER to exit..."
read
